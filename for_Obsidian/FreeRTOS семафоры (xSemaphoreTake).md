#freertos
[[FreeRTOS]]

#### **Семафоры (`xSemaphoreTake`)**

Семафоры используются для синхронизации задач или управления доступом к ресурсам.

##### **Пример работы `xSemaphoreTake`:**
```c
SemaphoreHandle_t mySemaphore;

void task1(void *args) {
    while (1) {
        xSemaphoreGive(mySemaphore);  // Освобождаем семафор
        vTaskDelay(pdMS_TO_TICKS(1000));  // Задержка 1 секунда
    }
}

void task2(void *args) {
    while (1) {
        // Ожидаем семафор с таймаутом 500 мс
        if (xSemaphoreTake(mySemaphore, pdMS_TO_TICKS(500))) {
            // Семафор получен
            uart_putc('G');
        } else {
            // Таймаут — семафор недоступен
            uart_putc('F');
        }
    }
}
```
##### **Механизм работы:**

- Если задача вызывает `xSemaphoreTake()`, но семафор недоступен (не был освобожден), задача блокируется.
- Если семафор освобождается в пределах указанного времени (`pdMS_TO_TICKS(500)`), задача становится готовой и получает семафор.
- Если семафор не был получен до истечения таймера, задача продолжает выполнение без него.
##### **Что происходит на уровне планировщика**

1. Когда задача блокируется из-за вызова `xQueueReceive()` или `xSemaphoreTake()`:
    - Планировщик освобождает процессор и переключает выполнение на другие задачи.
    - Если событие (получение данных или освобождение семафора) происходит, задача снова становится готовой (`Ready`).
2. Если указан таймаут, задача просто переходит в состояние **Ready** по истечении этого времени, даже если данные не поступили или семафор не освободился.

##### **Резюме**

Эти функции (`xQueueReceive`, `xSemaphoreTake`) позволяют задачам эффективно ждать необходимых событий, освобождая процессорное время для других задач, что критично для систем реального времени.